<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quantum Magnetism Journal v3 - Neural Revolution</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00ff88;
      --secondary: #ff0080;
      --accent: #00d4ff;
      --success: #00ff66;
      --warning: #ffaa00;
      --danger: #ff3366;
      --text-primary: #e8e8ff;
      --text-muted: #8888aa;
      --surface-main: #141420;
      --background-dark: #0a0a0f;
      --glass-bg: rgba(20, 20, 32, 0.8);
      --primary-gradient: linear-gradient(135deg, #00ff88 0%, #00d4ff 50%, #ff0080 100%);
      --shadow: 0 8px 32px rgba(0, 255, 136, 0.2);
      --glow: 0 0 20px rgba(0, 255, 136, 0.3);
      --consciousness-purple: #8b5cf6;
    }
    html, body {
      min-height: 100%;
      background: radial-gradient(circle at 20% 20%, rgba(0,255,136,0.08) 0%, transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(255,0,128,0.08) 0%, transparent 50%),
                  linear-gradient(135deg, #0a0a0f 0%, #141420 50%, #1a1a2e 100%);
      color: var(--text-primary);
      font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
      overflow-x: hidden;
    }
    .neural-particles {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none; z-index: 1; overflow: hidden;
    }
    .particle, .sigil {
      position: absolute;
      opacity: 0.5;
      pointer-events: none;
      will-change: transform, opacity;
    }
    .particle {
      border-radius: 50%;
      background: var(--primary-gradient);
      width: 8px; height: 8px;
      filter: blur(1px);
      animation: float 10s linear infinite;
    }
    @keyframes float {
      0% { transform: translateY(100vh) scale(0.7); opacity: 0; }
      10% { opacity: 0.7; }
      90% { opacity: 0.7; }
      100% { transform: translateY(-100px) scale(1.2); opacity: 0; }
    }
    .sigil {
      width: 80px; height: 80px;
      opacity: 0.08;
      filter: blur(0.5px);
      animation: sigil-float 30s linear infinite;
    }
    @keyframes sigil-float {
      0% { transform: translateY(0) rotate(0deg);}
      100% { transform: translateY(-40px) rotate(360deg);}
    }
    .glass {
      background: var(--glass-bg);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      border: 1.5px solid rgba(0,255,136,0.13);
    }
    .holo-border {
      border: 2.5px solid;
      border-image: var(--primary-gradient) 1;
      box-shadow: 0 0 12px 2px var(--accent), 0 0 0 2px var(--surface-main) inset;
      animation: border-glow 3s linear infinite;
    }
    @keyframes border-glow {
      0% { box-shadow: 0 0 12px 2px var(--accent), 0 0 0 2px var(--surface-main) inset; }
      50% { box-shadow: 0 0 24px 6px var(--secondary), 0 0 0 2px var(--surface-main) inset; }
      100% { box-shadow: 0 0 12px 2px var(--accent), 0 0 0 2px var(--surface-main) inset; }
    }
    .gradient-text {
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .center { display: flex; align-items: center; justify-content: center; }
    .header {
      text-align: center;
      margin-top: 2.5rem;
      margin-bottom: 2rem;
      z-index: 10;
      position: relative;
    }
    .logo-title {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 700;
      letter-spacing: -2px;
      margin-bottom: 0.5rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: neural-pulse 3s ease-in-out infinite;
    }
    @keyframes neural-pulse {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .tagline {
      font-size: 1.3rem;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      font-weight: 500;
    }
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem 3rem 1rem;
      position: relative;
      z-index: 10;
    }
    .glass-card {
      margin-bottom: 2rem;
      padding: 2rem 1.5rem;
      position: relative;
      transition: box-shadow 0.3s;
    }
    .glass-card:hover {
      box-shadow: 0 0 32px 8px var(--accent);
    }
    .session-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .session-card {
      flex: 1 1 300px;
      min-width: 280px;
      max-width: 350px;
      padding: 1.5rem 1rem;
      margin: 0.5rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border-radius: 18px;
      border: 2px solid transparent;
      background: var(--glass-bg);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .session-card.active, .session-card:hover {
      border-image: var(--primary-gradient) 1;
      box-shadow: 0 0 32px 8px var(--accent);
      transform: scale(1.03);
    }
    .session-card.completed {
      border-color: var(--success);
      box-shadow: 0 0 24px 4px var(--success);
      background: rgba(0,255,136,0.08);
    }
    .session-card.locked {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: var(--text-muted);
    }
    .session-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--primary);
      letter-spacing: 1px;
    }
    .session-desc {
      color: var(--text-muted);
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .session-duration {
      color: var(--accent);
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .session-status {
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.3rem 1rem;
      display: inline-block;
      margin-top: 0.5rem;
    }
    .status-ready { background: rgba(0,255,136,0.13); color: var(--primary); border: 1px solid var(--primary);}
    .status-completed { background: rgba(0,255,136,0.18); color: var(--success); border: 1px solid var(--success);}
    .status-locked { background: rgba(136,136,170,0.13); color: var(--text-muted); border: 1px solid var(--text-muted);}
    .neural-button {
      background: var(--primary-gradient);
      color: var(--background-dark);
      border: none;
      border-radius: 12px;
      padding: 1rem 2rem;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      margin: 0.5rem 0.5rem 0 0;
      box-shadow: 0 2px 12px 0 rgba(0,255,136,0.13);
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .neural-button:hover {
      transform: scale(1.04);
      box-shadow: 0 8px 32px 0 var(--accent);
    }
    .neural-button.secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .neural-button.danger {
      background: linear-gradient(135deg, #ff3366, #ff6b9d);
      color: #fff;
    }
    .neural-input {
      width: 100%;
      padding: 1rem;
      background: var(--glass-bg);
      border: 2px solid var(--primary);
      border-radius: 12px;
      color: var(--text-primary);
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1rem;
      margin-bottom: 1rem;
      transition: all 0.2s;
    }
    .neural-input:focus {
      outline: none;
      box-shadow: 0 0 24px 4px var(--accent);
      border-color: var(--accent);
    }
    .stats-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .stat-card {
      min-width: 180px;
      max-width: 220px;
      flex: 1 1 180px;
      background: var(--glass-bg);
      border-radius: 16px;
      border: 1.5px solid var(--accent);
      padding: 1.2rem 1rem;
      text-align: center;
      box-shadow: var(--shadow);
      margin-bottom: 0.5rem;
    }
    .stat-value {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.2rem;
      font-family: 'JetBrains Mono', monospace;
    }
    .stat-label {
      color: var(--text-muted);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .achievement-popup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--glass-bg);
      border: 2.5px solid var(--primary);
      border-radius: 22px;
      padding: 2.5rem 2rem;
      text-align: center;
      z-index: 2000;
      box-shadow: 0 0 64px 8px var(--accent);
      backdrop-filter: blur(24px);
      transition: transform 0.5s cubic-bezier(0.68,-0.55,0.265,1.55);
      opacity: 0.98;
    }
    .achievement-popup.show {
      transform: translate(-50%, -50%) scale(1);
    }
    .achievement-icon {
      font-size: 3.5rem;
      margin-bottom: 1.2rem;
      animation: bounce 1.2s ease infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0);}
      50% { transform: translateY(-12px);}
    }
    .achievement-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    .achievement-desc {
      color: var(--text-muted);
      margin-bottom: 1.2rem;
    }
    @media (max-width: 900px) {
      .main-container, .stats-panel, .session-cards { flex-direction: column; align-items: stretch; }
      .session-cards { gap: 1.2rem; }
      .stats-panel { gap: 1rem; }
    }
    @media (max-width: 600px) {
      .main-container { padding: 1rem 0.2rem 2rem 0.2rem; }
      .session-card, .stat-card { min-width: 90vw; max-width: 98vw; }
      .glass-card { padding: 1.2rem 0.5rem; }
    }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Particle & Sigil System -->
  <div class="neural-particles" id="neural-particles"></div>
  <!-- Esoteric SVG Sigils (hidden, used for particles) -->
  <svg style="display:none">
    <symbol id="solomon1" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" stroke="#00d4ff" stroke-width="2" fill="none"/>
      <polygon points="50,10 90,90 10,90" stroke="#ff0080" stroke-width="2" fill="none"/>
      <polygon points="50,90 90,10 10,10" stroke="#00ff88" stroke-width="2" fill="none"/>
      <text x="50" y="55" font-size="18" text-anchor="middle" fill="#8b5cf6" font-family="JetBrains Mono">◊ô◊î◊ï◊î</text>
    </symbol>
    <symbol id="solomon2" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="48" stroke="#8b5cf6" stroke-width="2" fill="none"/>
      <rect x="20" y="20" width="60" height="60" stroke="#ffaa00" stroke-width="2" fill="none"/>
      <text x="50" y="55" font-size="18" text-anchor="middle" fill="#ff0080" font-family="JetBrains Mono">◊ê◊ú ◊©◊ì◊ô</text>
    </symbol>
    <symbol id="merkaba" viewBox="0 0 100 100">
      <polygon points="50,10 90,80 10,80" stroke="#00d4ff" stroke-width="2" fill="none"/>
      <polygon points="50,90 90,20 10,20" stroke="#ff0080" stroke-width="2" fill="none"/>
      <circle cx="50" cy="50" r="40" stroke="#00ff88" stroke-width="1.5" fill="none"/>
    </symbol>
  </svg>
  <!-- Header -->
  <div class="header">
    <div class="logo-title">QUANTUM MAGNETISM</div>
    <div class="tagline gradient-text">Behavioral OS for Consciousness Evolution</div>
  </div>
  <div class="main-container">
    <!-- Session Cards -->
    <div class="session-cards" id="session-cards"></div>
    <!-- Stats Panel -->
    <div class="stats-panel" id="stats-panel"></div>
    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
      <div class="achievement-icon" id="achievement-icon">üèÜ</div>
      <div class="achievement-title" id="achievement-title">Achievement Unlocked!</div>
      <div class="achievement-desc" id="achievement-desc">You've made progress!</div>
      <button class="neural-button" onclick="closeAchievement()">Acknowledged</button>
    </div>
  </div>
  <!-- Onboarding Modal -->
  <div class="achievement-popup" id="onboarding-modal" style="z-index:3000; background: var(--glass-bg); border: 2.5px solid var(--primary);">
    <div id="onboarding-content"></div>
  </div>
  <script>
    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyBRHtJm3DeIbH1X0ZhELvUWgXZYaVJjC68",
      authDomain: "quantum-magnetism.firebaseapp.com",
      projectId: "quantum-magnetism",
      storageBucket: "quantum-magnetism.appspot.com",
      messagingSenderId: "835975916056",
      appId: "1:835975916056:web:d830d5f092ba8d4201716d",
      measurementId: "G-F7QHS67C76"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // --- Particle & Sigil System ---
    function spawnParticlesAndSigils() {
      const container = document.getElementById('neural-particles');
      function randomBetween(a, b) { return a + Math.random() * (b - a); }
      setInterval(() => {
        // Particle
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = randomBetween(0, 98) + 'vw';
        p.style.top = randomBetween(0, 98) + 'vh';
        p.style.background = `radial-gradient(circle, var(--primary), var(--accent), var(--secondary))`;
        p.style.opacity = Math.random() * 0.5 + 0.3;
        p.style.animationDuration = randomBetween(7, 14) + 's';
        container.appendChild(p);
        setTimeout(() => p.remove(), 14000);

        // Occasionally spawn a sigil
        if (Math.random() < 0.13) {
          const s = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          s.classList.add('sigil');
          s.style.left = randomBetween(0, 92) + 'vw';
          s.style.top = randomBetween(0, 92) + 'vh';
          s.style.width = s.style.height = randomBetween(60, 120) + 'px';
          const sigilIds = ['solomon1', 'solomon2', 'merkaba'];
          const use = document.createElementNS("http://www.w3.org/2000/svg", "use");
          use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + sigilIds[Math.floor(Math.random()*sigilIds.length)]);
          s.appendChild(use);
          container.appendChild(s);
          setTimeout(() => s.remove(), 30000);
        }
      }, 600);
    }
    spawnParticlesAndSigils();

    // --- App State ---
    let user = null;
    let state = {
      onboarding: false,
      day: 1,
      identity: null,
      goal: "",
      progress: { morning: false, midday: false, evening: false },
      rmu: 0,
      achievements: [],
    };

    // --- Onboarding Flow ---
    const onboardingSteps = [
      {
        title: "üöÄ Reality Architecture Mode: ACTIVATED",
        desc: "Welcome to the consciousness revolution.<br>Time to debug your reality and install some LEGENDARY upgrades.",
        input: null,
        button: "Initialize Protocol"
      },
      {
        title: "üéØ Reality Target Selection",
        desc: "What reality are you collapsing into existence?<br><b>Be specific.</b> The universe responds to precision.",
        input: { type: "text", id: "goal-input", placeholder: "e.g., 'CEO of breakthrough AI company...'" },
        button: "Lock Target ‚Üí"
      },
      {
        title: "üé≠ Quantum Identity Selection",
        desc: "Choose your transformation archetype.<br>This determines your daily reality-hacking protocols.",
        input: { type: "archetype" },
        button: "Activate Identity ‚Üí"
      },
      {
        title: "‚ö° Consciousness Engine: READY",
        desc: "<b>Upgrade to:</b> 'I am the universe debugging itself.'<br>Ready to begin?",
        input: null,
        button: "üöÄ Launch Reality Architecture Engine"
      }
    ];
    let onboardingStep = 0;
    function showOnboarding() {
      const modal = document.getElementById('onboarding-modal');
      const content = document.getElementById('onboarding-content');
      modal.classList.add('show');
      content.innerHTML = '';
      const step = onboardingSteps[onboardingStep];
      content.innerHTML = `
        <div class="achievement-title" style="margin-bottom:1rem;">${step.title}</div>
        <div class="achievement-desc" style="margin-bottom:1.5rem;">${step.desc}</div>
        ${step.input ? renderOnboardingInput(step.input) : ''}
        <button class="neural-button" id="onboarding-next">${step.button}</button>
      `;
      if (step.input && step.input.type === "archetype") {
        document.querySelectorAll('.archetype-card').forEach(card => {
          card.onclick = () => {
            document.querySelectorAll('.archetype-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
          };
        });
      }
      document.getElementById('onboarding-next').onclick = onboardingNext;
    }
    function renderOnboardingInput(input) {
      if (input.type === "text") {
        return `<input type="text" id="${input.id}" class="neural-input" placeholder="${input.placeholder}" style="margin-bottom:1rem;">`;
      }
      if (input.type === "archetype") {
        return `
          <div style="display:flex;gap:1rem;justify-content:center;margin-bottom:1rem;">
            <div class="archetype-card glass holo-border" data-id="visionary" style="padding:1.2rem;cursor:pointer;">
              <div style="font-size:2rem;">üîÆ</div>
              <div style="font-weight:700;">Visionary</div>
              <div style="font-size:0.9rem;color:var(--text-muted);">See beyond current reality</div>
            </div>
            <div class="archetype-card glass holo-border" data-id="creator" style="padding:1.2rem;cursor:pointer;">
              <div style="font-size:2rem;">‚ú®</div>
              <div style="font-weight:700;">Creator</div>
              <div style="font-size:0.9rem;color:var(--text-muted);">Build new worlds daily</div>
            </div>
            <div class="archetype-card glass holo-border" data-id="warrior" style="padding:1.2rem;cursor:pointer;">
              <div style="font-size:2rem;">‚öîÔ∏è</div>
              <div style="font-weight:700;">Warrior</div>
              <div style="font-size:0.9rem;color:var(--text-muted);">Conquer all limitations</div>
            </div>
            <div class="archetype-card glass holo-border" data-id="mystic" style="padding:1.2rem;cursor:pointer;">
              <div style="font-size:2rem;">üåü</div>
              <div style="font-weight:700;">Mystic</div>
              <div style="font-size:0.9rem;color:var(--text-muted);">Connect with infinite intelligence</div>
            </div>
          </div>
        `;
      }
      return '';
    }
    function onboardingNext() {
      if (onboardingStep === 1) {
        const val = document.getElementById('goal-input').value.trim();
        if (!val) { alert("Reality target required."); return; }
        state.goal = val;
      }
      if (onboardingStep === 2) {
        const sel = document.querySelector('.archetype-card.active');
        if (!sel) { alert("Select an archetype."); return; }
        state.identity = sel.dataset.id;
      }
      onboardingStep++;
      if (onboardingStep < onboardingSteps.length) {
        showOnboarding();
      } else {
        document.getElementById('onboarding-modal').classList.remove('show');
        state.onboarding = true;
        saveState();
        renderApp();
      }
    }

    // --- Firebase Auth & State Sync ---
    function saveState() {
      if (!user) return;
      console.log('Saving state:', state);
      db.collection('users').doc(user.uid).set(state, { merge: true });
    }
    function loadState() {
      if (!user) return;
      console.log('Loading state for user:', user.uid);
      db.collection('users').doc(user.uid).get().then(doc => {
        console.log('State loaded:', doc.exists ? doc.data() : 'No data');
        if (doc.exists) {
          Object.assign(state, doc.data());
        }
        if (!state.onboarding) {
          console.log('Starting onboarding');
          onboardingStep = 0;
          showOnboarding();
        } else {
          console.log('Rendering app');
          renderApp();
        }
      }).catch(error => {
        console.error('Error loading state:', error);
      });
    }
    auth.onAuthStateChanged(u => {
      console.log('Auth state changed:', u ? 'User logged in' : 'No user');
      user = u;
      if (!user) {
        console.log('Attempting anonymous sign in');
        auth.signInAnonymously().catch(error => {
          console.error('Error signing in:', error);
        });
      } else {
        loadState();
      }
    });

    // --- Main App Render ---
    function renderApp() {
      console.log('Rendering app components');
      renderSessionCards();
      renderStatsPanel();
      document.getElementById('onboarding-modal').classList.remove('show');
    }

    // --- Session Cards ---
    function renderSessionCards() {
      console.log('Rendering session cards');
      const container = document.getElementById('session-cards');
      if (!container) {
        console.error('Session cards container not found!');
        return;
      }
      container.innerHTML = '';
      const sessions = [
        { key: 'morning', icon: 'üåÖ', title: 'Morning Neural Sync', desc: 'Reality selection & quantum debugging', duration: '8 min' },
        { key: 'midday', icon: '‚ö°', title: 'Midday Frequency Check', desc: 'Timeline calibration & sync logging', duration: '3 min' },
        { key: 'evening', icon: 'üåå', title: 'Evening Integration', desc: 'Evidence docs & pattern debugging', duration: '9 min' }
      ];
      sessions.forEach((s, i) => {
        let status = 'locked', statusText = 'Locked';
        if (i === 0 || state.progress[sessions[i-1].key]) {
          status = state.progress[s.key] ? 'completed' : 'ready';
          statusText = state.progress[s.key] ? 'Complete' : 'Ready to Launch';
        }
        const card = document.createElement('div');
        card.className = `session-card glass holo-border ${status}${state.progress[s.key] ? ' completed' : ''}`;
        card.innerHTML = `
          <div style="font-size:2.2rem;">${s.icon}</div>
          <div class="session-title">${s.title}</div>
          <div class="session-desc">${s.desc}</div>
          <div class="session-duration">${s.duration}</div>
          <div class="session-status status-${status}">${statusText}</div>
        `;
        if (status !== 'locked') {
          card.onclick = () => startSession(s.key);
        }
        container.appendChild(card);
      });
    }

    // --- Stats Panel ---
    function renderStatsPanel() {
      const container = document.getElementById('stats-panel');
      container.innerHTML = '';
      const stats = [
        { label: "Coherence Streak", value: state.rmu, icon: "üî•" },
        { label: "Quantum Score", value: state.rmu, icon: "‚ö°" },
        { label: "Achievements", value: state.achievements.length, icon: "üèÜ" },
        { label: "Progress", value: `${Math.round((Object.values(state.progress).filter(Boolean).length/3)*100)}%`, icon: "üéØ" }
      ];
      stats.forEach(s => {
        const card = document.createElement('div');
        card.className = 'stat-card glass';
        card.innerHTML = `
          <div style="font-size:2rem;">${s.icon}</div>
          <div class="stat-value">${s.value}</div>
          <div class="stat-label">${s.label}</div>
        `;
        container.appendChild(card);
      });
    }

    // --- Session Start ---
    function startSession(key) {
      // For demo: mark as complete, increment RMU, show achievement
      state.progress[key] = true;
      state.rmu += 100;
      saveState();
      renderSessionCards();
      renderStatsPanel();
      unlockAchievement(key + "_complete");
    }

    // --- Achievements ---
    function unlockAchievement(key) {
      if (state.achievements.includes(key)) return;
      state.achievements.push(key);
      showAchievementPopup(key);
      saveState();
    }
    function showAchievementPopup(key) {
      const popup = document.getElementById('achievement-popup');
      const icon = document.getElementById('achievement-icon');
      const title = document.getElementById('achievement-title');
      const desc = document.getElementById('achievement-desc');
      icon.textContent = "üèÜ";
      title.textContent = "Achievement Unlocked!";
      desc.textContent = `You completed: ${key.replace("_complete","").toUpperCase()}`;
      popup.classList.add('show');
    }
    function closeAchievement() {
      document.getElementById('achievement-popup').classList.remove('show');
    }

    // --- Onboarding Modal Show/Hide ---
    window.closeAchievement = closeAchievement;

    // --- Responsive Onboarding Modal ---
    window.addEventListener('resize', () => {
      if (window.innerWidth < 600) {
        document.getElementById('onboarding-modal').style.padding = "0.5rem";
      } else {
        document.getElementById('onboarding-modal').style.padding = "2rem";
      }
    });
  </script>
</body>
</html>